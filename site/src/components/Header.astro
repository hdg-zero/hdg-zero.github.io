---
// site/src/components/Header.astro
// Ultra Pro Floating Glass Navigation

const base = import.meta.env.BASE_URL;

const navItems = [
  { href: `${base}`, label: 'Accueil', dataAttr: 'data-nav-home' },
  { href: `${base}projects`, label: 'Projets', dataAttr: 'data-nav-work' },
  { href: `${base}blog`, label: 'Blog', dataAttr: 'data-nav-blog' },
];

const currentPath = Astro.url.pathname;
---

<header id="site-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-500">
  <div class="container mx-auto px-4 sm:px-6 py-3 sm:py-4">
    <div class="relative">
      <!-- Floating Glass Nav Pill -->
      <nav class="mx-auto max-w-fit glass-nav rounded-full px-2 py-2 flex items-center gap-1 transition-all duration-500" id="nav-pill">
        
        <!-- Logo -->
        <a 
          href={base} 
          class="group flex items-center gap-2 px-4 py-2 rounded-full hover:bg-white/5 transition-all duration-300"
        >
          <div class="relative">
            <div class="w-8 h-8 rounded-xl bg-gradient-to-br from-[var(--accent-primary)] to-[var(--accent-secondary)] flex items-center justify-center font-bold text-white text-sm group-hover:scale-110 transition-transform duration-300">
              H
            </div>
            <div class="absolute inset-0 rounded-xl bg-[var(--accent-primary)] blur-xl opacity-0 group-hover:opacity-50 transition-opacity duration-500"></div>
          </div>
          <span class="font-semibold text-[var(--text-primary)] hidden sm:block tracking-tight">
            Hippolyte de Guign√©
          </span>
        </a>

        <!-- Divider -->
        <div class="w-px h-6 bg-white/10 mx-2 hidden sm:block"></div>

        <div class="flex items-center">
          {navItems.map((item) => {
            const isActive = currentPath === item.href || 
                            (item.href !== base && currentPath.startsWith(item.href));
            const attrs = { [item.dataAttr]: true };
            return (
              <a 
                href={item.href}
                class:list={[
                  "relative px-4 py-2 text-sm font-medium rounded-full transition-all duration-300",
                  isActive 
                    ? "text-[var(--text-primary)] bg-white/10" 
                    : "text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-white/5"
                ]}
                {...attrs}
              >
                {item.label}
                {isActive && (
                  <span class="absolute bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-[var(--accent-primary)]"></span>
                )}
              </a>
            );
          })}
        </div>

        <!-- Divider -->
        <div class="w-px h-6 bg-white/10 mx-2 hidden md:block"></div>

        <!-- Language Switcher -->
        <div class="hidden md:flex items-center gap-1 px-2 py-1 rounded-full bg-white/5 border border-[var(--glass-border)]">
          <button id="lang-fr" class="lang-btn active px-3 py-1 text-xs font-medium rounded-full transition-all">FR</button>
          <button id="lang-en" class="lang-btn px-3 py-1 text-xs font-medium rounded-full transition-all">EN</button>
        </div>

        <!-- Theme Toggle -->
        <button 
          id="theme-toggle"
          class="hidden md:flex items-center justify-center w-9 h-9 rounded-full bg-white/5 border border-[var(--glass-border)] hover:bg-white/10 transition-all"
          aria-label="Toggle theme"
        >
          <svg id="sun-icon" class="w-4 h-4 text-[var(--text-secondary)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
          <svg id="moon-icon" class="w-4 h-4 text-[var(--text-secondary)]" style="display: none;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
          </svg>
        </button>

        <!-- CTA Button -->
        <a 
          href="mailto:hdg-zero@pm.me" 
          class="hidden md:flex items-center gap-2 px-5 py-2 text-sm font-medium text-white bg-[var(--accent-primary)] rounded-full hover:bg-[var(--accent-primary)]/80 transition-all duration-300 hover:shadow-lg hover:shadow-[var(--accent-glow)]"
        >
          <span>Envoyer un mail</span>
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
          </svg>
        </a>

        <!-- Mobile menu button -->
        <button 
          id="mobile-menu-btn"
          class="md:hidden p-2 text-[var(--text-secondary)] hover:text-white rounded-full hover:bg-white/5 transition-all duration-300"
          aria-label="Menu"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </nav>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 right-0 mt-2 mx-3 sm:mx-4">
    <div class="glass-panel rounded-2xl p-3 sm:p-4 border border-[var(--glass-border)]">
      <ul class="flex flex-col gap-1">
        {navItems.map(item => (
          <li>
            <a 
              href={item.href}
              class="block px-4 py-3.5 text-[var(--text-secondary)] hover:text-white hover:bg-white/5 rounded-xl transition-all duration-300 text-base"
            >
              {item.label}
            </a>
          </li>
        ))}
        <li class="pt-3 mt-2 border-t border-white/5">
          <!-- Mobile Language Switcher -->
          <div class="flex items-center justify-center gap-2 px-4 py-2 mb-2">
            <button id="mobile-lang-fr" class="lang-btn-mobile active px-4 py-2.5 text-sm font-medium rounded-xl transition-all">FR</button>
            <button id="mobile-lang-en" class="lang-btn-mobile px-4 py-2.5 text-sm font-medium rounded-xl transition-all">EN</button>
          </div>
          <!-- Mobile Theme Toggle -->
          <button 
            id="mobile-theme-toggle"
            class="w-full flex items-center justify-center gap-2 px-4 py-3 mb-2 text-[var(--text-secondary)] hover:text-white bg-white/5 rounded-xl hover:bg-white/10 transition-all"
            aria-label="Toggle theme"
          >
            <svg id="mobile-sun-icon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            <span id="mobile-theme-text">Mode clair</span>
          </button>
        </li>
        <li>
          <a 
            href="mailto:hdg-zero@pm.me"
            class="flex items-center justify-center gap-2 px-4 py-3.5 text-white bg-[var(--accent-primary)] rounded-xl font-medium hover:bg-[var(--accent-primary)]/80 transition-all duration-300"
          >
            Envoyer un mail
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
            </svg>
          </a>
        </li>
      </ul>
    </div>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-16 sm:h-20"></div>

<script>
  // Mobile menu toggle
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  
  btn?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });

  // Close menu on navigation
  document.addEventListener('astro:before-preparation', () => {
    menu?.classList.add('hidden');
  });

  // Header scroll effect
  const header = document.getElementById('site-header');
  const navPill = document.getElementById('nav-pill');
  let lastScroll = 0;

  function handleScroll() {
    const currentScroll = window.scrollY;
    
    if (currentScroll > 50) {
      navPill?.classList.add('shadow-lg', 'shadow-black/20');
      header?.classList.add('py-2');
    } else {
      navPill?.classList.remove('shadow-lg', 'shadow-black/20');
      header?.classList.remove('py-2');
    }
    
    lastScroll = currentScroll;
  }

  window.addEventListener('scroll', handleScroll, { passive: true });
  
  // Re-run on navigation
  document.addEventListener('astro:page-load', () => {
    handleScroll();
    window.addEventListener('scroll', handleScroll, { passive: true });
    
    // Mobile theme toggle functionality
    const mobileThemeBtn = document.getElementById('mobile-theme-toggle');
    const mobileThemeText = document.getElementById('mobile-theme-text');
    
    function updateMobileThemeText() {
      const isDark = document.documentElement.classList.contains('dark');
      if (mobileThemeText) {
        mobileThemeText.textContent = isDark ? 'Mode clair' : 'Mode sombre';
      }
    }
    updateMobileThemeText();
    
    mobileThemeBtn?.addEventListener('click', () => {
      const isDark = document.documentElement.classList.contains('dark');
      document.documentElement.classList.remove('dark', 'light');
      document.documentElement.classList.add(isDark ? 'light' : 'dark');
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
      updateMobileThemeText();
    });
    
    // Mobile language toggle functionality
    const mobileLangFr = document.getElementById('mobile-lang-fr');
    const mobileLangEn = document.getElementById('mobile-lang-en');
    
    function updateMobileLangButtons() {
      const lang = localStorage.getItem('lang') || 'fr';
      mobileLangFr?.classList.toggle('active', lang === 'fr');
      mobileLangEn?.classList.toggle('active', lang === 'en');
    }
    updateMobileLangButtons();
    
    mobileLangFr?.addEventListener('click', () => {
      localStorage.setItem('lang', 'fr');
      document.documentElement.setAttribute('data-lang', 'fr');
      document.documentElement.lang = 'fr';
      updateMobileLangButtons();
      // Trigger translations update (handled by BaseLayout)
      window.dispatchEvent(new CustomEvent('languageChange'));
    });
    
    mobileLangEn?.addEventListener('click', () => {
      localStorage.setItem('lang', 'en');
      document.documentElement.setAttribute('data-lang', 'en');
      document.documentElement.lang = 'en';
      updateMobileLangButtons();
      // Trigger translations update (handled by BaseLayout)
      window.dispatchEvent(new CustomEvent('languageChange'));
    });
  });
</script>

<style>
  .glass-nav {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 
      0 4px 24px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  :global(.light) .glass-nav {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
  }

  #site-header.py-2 .glass-nav {
    backdrop-filter: blur(40px) saturate(200%);
    -webkit-backdrop-filter: blur(40px) saturate(200%);
    background: rgba(0, 0, 0, 0.8);
  }

  :global(.light) #site-header.py-2 .glass-nav {
    background: rgba(255, 255, 255, 0.9);
  }

  .lang-btn {
    color: var(--text-muted);
  }

  .lang-btn.active {
    background: var(--accent-primary);
    color: white;
  }

  .lang-btn-mobile {
    color: var(--text-muted);
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
  }

  .lang-btn-mobile.active {
    background: var(--accent-primary);
    color: white;
    border-color: var(--accent-primary);
  }

  @media (max-width: 640px) {
    .glass-nav {
      width: 100%;
      max-width: 100%;
      justify-content: space-between;
    }
  }
</style>

