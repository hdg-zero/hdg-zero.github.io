---
// site/src/layouts/BaseLayout.astro
// Ultra Pro Layout with Theme & i18n Support
import Header from '../components/Header.astro';
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';

interface Props {
	title: string;
	description?: string;
}

const { title, description = "Hippolyte de Guigné — Digital Architect" } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<!doctype html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href={`${base}favicon.svg`} />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Open Graph -->
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:type" content="website" />
		
		<title>{title}</title>
		<ViewTransitions />

		<!-- Theme & Language initialization (MUST run immediately) -->
		<script is:inline>
			// Run immediately to prevent flash
			(function() {
				const theme = localStorage.getItem('theme') || 'dark';
				document.documentElement.classList.remove('dark', 'light');
				document.documentElement.classList.add(theme);
				
				const lang = localStorage.getItem('lang') || 'fr';
				document.documentElement.setAttribute('data-lang', lang);
				document.documentElement.lang = lang;
			})();
			
			// Also run on Astro view transitions
			document.addEventListener('astro:before-swap', (event) => {
				const theme = localStorage.getItem('theme') || 'dark';
				event.newDocument.documentElement.classList.remove('dark', 'light');
				event.newDocument.documentElement.classList.add(theme);
				
				const lang = localStorage.getItem('lang') || 'fr';
				event.newDocument.documentElement.setAttribute('data-lang', lang);
				event.newDocument.documentElement.lang = lang;
			});
		</script>
	</head>
	<body class="min-h-screen flex flex-col font-display antialiased">
		<Header />
		
		<main class="flex-1">
			<slot />
		</main>
		
		<!-- Minimal Footer -->
		<footer class="relative border-t border-[var(--glass-border)] mt-20">
			<!-- Ambient glow -->
			<div class="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[1px] bg-gradient-to-r from-transparent via-[var(--accent-primary)] to-transparent opacity-50"></div>
			
			<div class="container mx-auto px-6 py-12">
				<div class="flex flex-col md:flex-row justify-between items-center gap-6">
					
					<!-- Brand -->
					<a href={base} class="inline-flex items-center gap-3 group">
						<div class="w-8 h-8 rounded-xl bg-gradient-to-br from-[var(--accent-primary)] to-[var(--accent-secondary)] flex items-center justify-center font-bold text-white text-sm group-hover:scale-110 transition-transform">
							H
						</div>
						<span class="font-semibold text-[var(--text-primary)]">Hippolyte de Guigné</span>
					</a>

					<!-- Social Links -->
					<div class="flex items-center gap-4">
						<a href="https://github.com/hdg-zero" target="_blank" rel="noopener" 
						   class="text-[var(--text-muted)] hover:text-[var(--accent-primary)] transition-colors">
							<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
								<path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
							</svg>
						</a>
						<a href="https://fr.linkedin.com/in/hippolyte-de-guigné" target="_blank" rel="noopener" 
						   class="text-[var(--text-muted)] hover:text-[var(--accent-primary)] transition-colors">
							<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
								<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
							</svg>
						</a>
						<a href="mailto:hdg-zero@pm.me" 
						   class="text-[var(--text-muted)] hover:text-[var(--accent-primary)] transition-colors">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
							</svg>
						</a>
					</div>
				</div>
			</div>
		</footer>

		<script>
			// Translations object
			const translations = {
				fr: {
					nav: { home: 'Accueil', work: 'Projets', blog: 'Blog', contact: 'Contact' },
					hero: {
						headline: 'Déveloper et',
						headlineAccent: 'partager.',
						subtitle: 'Ingénieur en systèmes d\'information, j\'explore au quotidien la nécessité de la protection des données personnelles et privées, le potentiel de l\'IA générative et toute sorte de sujet touchant de près ou loin aux technologies de l\'information.',
						viewWork: 'Voir mes projets',
						readBlog: 'Lire le blog',
					},
					work: {
						sectionLabel: 'Travaux sélectionnés',
						title: 'Projets',
						titleAccent: 'récents',
						description: 'Une collection de mes travaux récents.',
						latest: 'Dernier',
						viewAll: 'Voir tous les projets',
						viewDetails: 'Voir le détail',
					},
					blog: {
						sectionLabel: 'Blog',
						title: 'Articles &',
						titleAccent: 'réflexions',
						description: 'Plongées profondes dans le développement web.',
						readArticle: 'Lire l\'article',
						minRead: 'min de lecture',
						noArticles: 'Aucun article',
						comingSoon: 'Les articles arrivent bientôt !',
						subscribe: 'S\'abonner',
						stayUpdated: 'Restez informé',
						newsletterDesc: 'Recevez les nouveaux articles par email.',
						engineeringBlog: 'Blog technique',
						blogDesc: 'Plongées dans le code.',
						readArticles: 'Lire',
					},
					projects: {
						sectionLabel: 'Portfolio',
						title: 'Mes',
						titleAccent: 'projets',
						description: 'Une sélection de mes travaux récents.',
						all: 'Tous',
						noProjects: 'Aucun projet',
						comingSoon: 'Projets à venir !',
						viewDetails: 'Voir le détail',
					},
					cta: {
						title: 'Construisons quelque chose',
						titleAccent: 'd\'extraordinaire',
						description: 'Vous avez un projet ? Parlons-en.',
						getInTouch: 'Me contacter',
					},
				},
				en: {
					nav: { home: 'Home', work: 'Work', blog: 'Blog', contact: 'Contact' },
					hero: {
						headline: 'Develop and',
						headlineAccent: 'share.',
						subtitle: 'Information systems engineer, I explore daily the need for personal and private data protection, the potential of generative AI, and all kinds of topics related to information technology.',
						viewWork: 'View Projects',
						readBlog: 'Read Blog',
					},
					work: {
						sectionLabel: 'Selected Work',
						title: 'Featured',
						titleAccent: 'projects',
						description: 'A curated collection of recent work.',
						latest: 'Latest',
						viewAll: 'View all projects',
						viewDetails: 'View details',
					},
					blog: {
						sectionLabel: 'Blog',
						title: 'Articles &',
						titleAccent: 'thoughts',
						description: 'Deep dives into web development.',
						readArticle: 'Read article',
						minRead: 'min read',
						noArticles: 'No articles yet',
						comingSoon: 'First articles coming soon!',
						subscribe: 'Subscribe',
						stayUpdated: 'Stay updated',
						newsletterDesc: 'Get new articles by email.',
						engineeringBlog: 'Engineering Blog',
						blogDesc: 'Deep dives into code.',
						readArticles: 'Read',
					},
					projects: {
						sectionLabel: 'Portfolio',
						title: 'My',
						titleAccent: 'projects',
						description: 'A curated selection of recent work.',
						all: 'All',
						noProjects: 'No projects yet',
						comingSoon: 'Projects coming soon!',
						viewDetails: 'View details',
					},
					cta: {
						title: 'Let\'s build something',
						titleAccent: 'extraordinary',
						description: 'Have a project in mind? Let\'s talk.',
						getInTouch: 'Get in touch',
					},
				},
			};
			
			// Get current language
			function getLang() {
				return localStorage.getItem('lang') || 'fr';
			}
			
			// Get translation
			function t(path) {
				const lang = getLang();
				const keys = path.split('.');
				let value = translations[lang];
				for (const key of keys) {
					value = value?.[key];
				}
				return value || path;
			}
			
			// Apply translations to data-i18n elements
			function applyTranslations() {
				const lang = getLang();
				document.querySelectorAll('[data-i18n]').forEach(el => {
					const key = el.getAttribute('data-i18n');
					const translation = t(key);
					if (translation && translation !== key) {
						el.textContent = translation;
					}
				});
				
				// Update nav items
				document.querySelectorAll('[data-nav-home]').forEach(el => el.textContent = t('nav.home'));
				document.querySelectorAll('[data-nav-work]').forEach(el => el.textContent = t('nav.work'));
				document.querySelectorAll('[data-nav-blog]').forEach(el => el.textContent = t('nav.blog'));
				document.querySelectorAll('[data-nav-contact]').forEach(el => el.textContent = t('nav.contact'));
				
				// Update hero
				document.querySelectorAll('[data-hero-headline]').forEach(el => el.textContent = t('hero.headline'));
				document.querySelectorAll('[data-hero-headline-accent]').forEach(el => el.textContent = t('hero.headlineAccent'));
				document.querySelectorAll('[data-hero-subtitle]').forEach(el => el.textContent = t('hero.subtitle'));
				document.querySelectorAll('[data-hero-view-work]').forEach(el => el.textContent = t('hero.viewWork'));
				document.querySelectorAll('[data-hero-read-blog]').forEach(el => el.textContent = t('hero.readBlog'));
				
				// Update work section
				document.querySelectorAll('[data-work-label]').forEach(el => el.textContent = t('work.sectionLabel'));
				document.querySelectorAll('[data-work-title]').forEach(el => el.textContent = t('work.title'));
				document.querySelectorAll('[data-work-title-accent]').forEach(el => el.textContent = t('work.titleAccent'));
				document.querySelectorAll('[data-work-latest]').forEach(el => el.textContent = t('work.latest'));
				document.querySelectorAll('[data-work-view-all]').forEach(el => el.textContent = t('work.viewAll'));
				document.querySelectorAll('[data-work-view-details]').forEach(el => el.textContent = t('work.viewDetails'));
				
				// Update blog
				document.querySelectorAll('[data-blog-label]').forEach(el => el.textContent = t('blog.sectionLabel'));
				document.querySelectorAll('[data-blog-title]').forEach(el => el.textContent = t('blog.title'));
				document.querySelectorAll('[data-blog-title-accent]').forEach(el => el.textContent = t('blog.titleAccent'));
				document.querySelectorAll('[data-blog-read-article]').forEach(el => el.textContent = t('blog.readArticle'));
				document.querySelectorAll('[data-blog-engineering]').forEach(el => el.textContent = t('blog.engineeringBlog'));
				document.querySelectorAll('[data-blog-read-articles]').forEach(el => el.textContent = t('blog.readArticles'));
				document.querySelectorAll('[data-blog-subscribe]').forEach(el => el.textContent = t('blog.subscribe'));
				document.querySelectorAll('[data-blog-stay-updated]').forEach(el => el.textContent = t('blog.stayUpdated'));
				
				// Update projects
				document.querySelectorAll('[data-projects-label]').forEach(el => el.textContent = t('projects.sectionLabel'));
				document.querySelectorAll('[data-projects-title]').forEach(el => el.textContent = t('projects.title'));
				document.querySelectorAll('[data-projects-title-accent]').forEach(el => el.textContent = t('projects.titleAccent'));
				document.querySelectorAll('[data-projects-all]').forEach(el => el.textContent = t('projects.all'));
				document.querySelectorAll('[data-projects-view-details]').forEach(el => el.textContent = t('projects.viewDetails'));
				
				// Update CTA
				document.querySelectorAll('[data-cta-title]').forEach(el => el.textContent = t('cta.title'));
				document.querySelectorAll('[data-cta-title-accent]').forEach(el => el.textContent = t('cta.titleAccent'));
				document.querySelectorAll('[data-cta-description]').forEach(el => el.textContent = t('cta.description'));
				document.querySelectorAll('[data-cta-button]').forEach(el => el.textContent = t('cta.getInTouch'));
			}
			
			// Initialize on page load
			document.addEventListener('astro:page-load', () => {
				const main = document.querySelector('main');
				if (main) {
					main.style.opacity = '0';
					main.style.transform = 'translateY(20px)';
					requestAnimationFrame(() => {
						main.style.transition = 'opacity 0.6s cubic-bezier(0.22, 1, 0.36, 1), transform 0.6s cubic-bezier(0.22, 1, 0.36, 1)';
						main.style.opacity = '1';
						main.style.transform = 'translateY(0)';
					});
				}

				// Mouse tracking for glass cards
				const cards = document.querySelectorAll('.bento-card, .glass-card');
				cards.forEach(card => {
					card.addEventListener('mousemove', (e) => {
						const rect = card.getBoundingClientRect();
						const x = ((e.clientX - rect.left) / rect.width) * 100;
						const y = ((e.clientY - rect.top) / rect.height) * 100;
						(card as HTMLElement).style.setProperty('--mouse-x', `${x}%`);
						(card as HTMLElement).style.setProperty('--mouse-y', `${y}%`);
					});
				});

				// Theme toggle
				const themeBtn = document.getElementById('theme-toggle');
				themeBtn?.addEventListener('click', () => {
					const isDark = document.documentElement.classList.contains('dark');
					document.documentElement.classList.remove('dark', 'light');
					document.documentElement.classList.add(isDark ? 'light' : 'dark');
					localStorage.setItem('theme', isDark ? 'light' : 'dark');
					updateThemeIcon();
				});

				function updateThemeIcon() {
					const isDark = document.documentElement.classList.contains('dark');
					const sunIcon = document.getElementById('sun-icon');
					const moonIcon = document.getElementById('moon-icon');
					if (sunIcon && moonIcon) {
						sunIcon.style.display = isDark ? 'block' : 'none';
						moonIcon.style.display = isDark ? 'none' : 'block';
					}
				}
				updateThemeIcon();

				// Language toggle
				const langFr = document.getElementById('lang-fr');
				const langEn = document.getElementById('lang-en');
				
				function updateLangButtons() {
					const lang = getLang();
					langFr?.classList.toggle('active', lang === 'fr');
					langEn?.classList.toggle('active', lang === 'en');
				}
				updateLangButtons();

				langFr?.addEventListener('click', () => {
					localStorage.setItem('lang', 'fr');
					document.documentElement.setAttribute('data-lang', 'fr');
					document.documentElement.lang = 'fr';
					updateLangButtons();
					applyTranslations();
				});

				langEn?.addEventListener('click', () => {
					localStorage.setItem('lang', 'en');
					document.documentElement.setAttribute('data-lang', 'en');
					document.documentElement.lang = 'en';
					updateLangButtons();
					applyTranslations();
				});
				
				// Apply translations on load
				applyTranslations();
			});
		</script>
	</body>
</html>
