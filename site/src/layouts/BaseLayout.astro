---
// site/src/layouts/BaseLayout.astro
// Ultra Pro Layout with Theme & i18n Support
import Header from '../components/Header.astro';
import '../styles/global.css';
import { ViewTransitions } from 'astro:transitions';
import { translations } from '../i18n/translations';

interface Props {
	title: string;
	description?: string;
}

const { title, description = "Hippolyte de Guigné" } = Astro.props;
const base = import.meta.env.BASE_URL;

// Serialize translations for client-side script
const translationsJson = JSON.stringify(translations);
---

<!doctype html>
<html lang="fr" class="scroll-smooth overflow-x-hidden">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href={`${base}favicon.svg`} />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Open Graph -->
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:type" content="website" />
		
		<title>{title}</title>
		<ViewTransitions />

		<!-- Theme & Language initialization (MUST run immediately) -->
		<script is:inline>
			// Run immediately to prevent flash
			(function() {
				const theme = localStorage.getItem('theme') || 'dark';
				document.documentElement.classList.remove('dark', 'light');
				document.documentElement.classList.add(theme);
				
				const lang = localStorage.getItem('lang') || 'fr';
				document.documentElement.setAttribute('data-lang', lang);
				document.documentElement.lang = lang;
			})();
			
			// Also run on Astro view transitions
			document.addEventListener('astro:before-swap', (event) => {
				const theme = localStorage.getItem('theme') || 'dark';
				event.newDocument.documentElement.classList.remove('dark', 'light');
				event.newDocument.documentElement.classList.add(theme);
				
				const lang = localStorage.getItem('lang') || 'fr';
				event.newDocument.documentElement.setAttribute('data-lang', lang);
				event.newDocument.documentElement.lang = lang;
			});
		</script>
	</head>
	
	<!-- 
      FIX MOBILE: 
      - overflow-x-hidden : Empêche le scroll horizontal indésirable
      - w-full : Force la largeur à 100% du viewport
      - relative : Crée un contexte de positionnement pour les éléments absolus internes
    -->
	<body class="min-h-screen flex flex-col font-display antialiased overflow-x-hidden w-full relative bg-[var(--bg-primary)] text-[var(--text-primary)]">
		<Header />
		
		<main class="flex-1 w-full relative">
			<slot />
		</main>
		
		<!-- Minimal Footer -->
		<footer class="relative border-t border-[var(--glass-border)] mt-20 w-full">
			<!-- Ambient glow (Maintenu par overflow-hidden du body) -->
			<div class="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[1px] bg-gradient-to-r from-transparent via-[var(--accent-primary)] to-transparent opacity-50"></div>
			
			<div class="container mx-auto px-4 sm:px-6 py-8 sm:py-12">
				<div class="flex flex-col md:flex-row justify-between items-center gap-6">
					
					<!-- Brand -->
					<a href={base} class="inline-flex items-center gap-3 group">
						<div class="w-8 h-8 rounded-xl bg-gradient-to-br from-[var(--accent-primary)] to-[var(--accent-secondary)] flex items-center justify-center font-bold text-white text-sm group-hover:scale-110 transition-transform">
							H
						</div>
						<span class="font-semibold text-[var(--text-primary)]">Hippolyte de Guigné</span>
					</a>

					<!-- Social Links -->
					<div class="flex items-center gap-4">
						<a href="https://github.com/hdg-zero" target="_blank" rel="noopener" 
						   class="text-[var(--text-muted)] hover:text-[var(--accent-primary)] transition-colors">
							<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
								<path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
							</svg>
						</a>
						<a href="https://fr.linkedin.com/in/hippolyte-de-guigné" target="_blank" rel="noopener" 
						   class="text-[var(--text-muted)] hover:text-[var(--accent-primary)] transition-colors">
							<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
								<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
							</svg>
						</a>
						<a href="mailto:hdg-zero@pm.me" 
						   class="text-[var(--text-muted)] hover:text-[var(--accent-primary)] transition-colors">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
							</svg>
						</a>
					</div>
				</div>
			</div>
		</footer>

		<script is:inline define:vars={{ translationsJson }}>
			// Store translations in window for access across scripts
			window.__translations = window.__translations || JSON.parse(translationsJson);
		</script>

		<script>
			// Get translations from window
			function getTranslations() {
				return window.__translations || { fr: {}, en: {} };
			}
			
			// Get current language
			function getLang() {
				return localStorage.getItem('lang') || 'fr';
			}
			
			// Get translation
			function t(path) {
				const lang = getLang();
				const translations = getTranslations();
				const keys = path.split('.');
				let value = translations[lang];
				for (const key of keys) {
					value = value?.[key];
				}
				return value || path;
			}
			
			// Apply translations to data-i18n elements
			function applyTranslations() {
				const lang = getLang();
				document.querySelectorAll('[data-i18n]').forEach(el => {
					const key = el.getAttribute('data-i18n');
					const translation = t(key);
					if (translation && translation !== key) {
						el.textContent = translation;
					}
				});
				
				// Update nav items
				document.querySelectorAll('[data-nav-home]').forEach(el => el.textContent = t('nav.home'));
				document.querySelectorAll('[data-nav-work]').forEach(el => el.textContent = t('nav.work'));
				document.querySelectorAll('[data-nav-blog]').forEach(el => el.textContent = t('nav.blog'));
				document.querySelectorAll('[data-nav-contact]').forEach(el => el.textContent = t('nav.contact'));
				
				// Update hero
				document.querySelectorAll('[data-hero-headline]').forEach(el => el.textContent = t('hero.headline'));
				document.querySelectorAll('[data-hero-headline-accent]').forEach(el => el.textContent = t('hero.headlineAccent'));
				document.querySelectorAll('[data-hero-subtitle]').forEach(el => el.textContent = t('hero.subtitle'));
				document.querySelectorAll('[data-hero-view-work]').forEach(el => el.textContent = t('hero.viewWork'));
				document.querySelectorAll('[data-hero-read-blog]').forEach(el => el.textContent = t('hero.readBlog'));
				
				// Update work section
				document.querySelectorAll('[data-work-label]').forEach(el => el.textContent = t('work.sectionLabel'));
				document.querySelectorAll('[data-work-title]').forEach(el => el.textContent = t('work.title'));
				document.querySelectorAll('[data-work-title-accent]').forEach(el => el.textContent = t('work.titleAccent'));
				document.querySelectorAll('[data-work-description]').forEach(el => el.textContent = t('work.description'));
				document.querySelectorAll('[data-work-latest]').forEach(el => el.textContent = t('work.latest'));
				document.querySelectorAll('[data-work-view-all]').forEach(el => el.textContent = t('work.viewAll'));
				document.querySelectorAll('[data-work-view-details]').forEach(el => el.textContent = t('work.viewDetails'));
				
				// Update blog
				document.querySelectorAll('[data-blog-label]').forEach(el => el.textContent = t('blog.sectionLabel'));
				document.querySelectorAll('[data-blog-title]').forEach(el => el.textContent = t('blog.title'));
				document.querySelectorAll('[data-blog-title-accent]').forEach(el => el.textContent = t('blog.titleAccent'));
				document.querySelectorAll('[data-blog-description]').forEach(el => el.textContent = t('blog.description'));
				document.querySelectorAll('[data-blog-read-article]').forEach(el => el.textContent = t('blog.readArticle'));
				document.querySelectorAll('[data-blog-engineering]').forEach(el => el.textContent = t('blog.engineeringBlog'));
				document.querySelectorAll('[data-blog-blog-desc]').forEach(el => el.textContent = t('blog.blogDesc'));
				document.querySelectorAll('[data-blog-read-articles]').forEach(el => el.textContent = t('blog.readArticles'));
				document.querySelectorAll('[data-blog-subscribe]').forEach(el => el.textContent = t('blog.subscribe'));
				document.querySelectorAll('[data-blog-stay-updated]').forEach(el => el.textContent = t('blog.stayUpdated'));
				
				// Update projects
				document.querySelectorAll('[data-projects-label]').forEach(el => el.textContent = t('projects.sectionLabel'));
				document.querySelectorAll('[data-projects-title]').forEach(el => el.textContent = t('projects.title'));
				document.querySelectorAll('[data-projects-title-accent]').forEach(el => el.textContent = t('projects.titleAccent'));
				document.querySelectorAll('[data-projects-description]').forEach(el => el.textContent = t('projects.description'));
				document.querySelectorAll('[data-projects-all]').forEach(el => el.textContent = t('projects.all'));
				document.querySelectorAll('[data-projects-view-details]').forEach(el => el.textContent = t('projects.viewDetails'));
				document.querySelectorAll('[data-projects-no-projects]').forEach(el => el.textContent = t('projects.noProjects'));
				document.querySelectorAll('[data-projects-coming-soon]').forEach(el => el.textContent = t('projects.comingSoon'));
			
				// Update blog article page
				document.querySelectorAll('[data-i18n="blog.backToBlog"]').forEach(el => el.textContent = t('blog.backToBlog'));
				document.querySelectorAll('[data-i18n="blog.allArticles"]').forEach(el => el.textContent = t('blog.allArticles'));
				document.querySelectorAll('[data-i18n="blog.alsoRead"]').forEach(el => el.textContent = t('blog.alsoRead'));
				document.querySelectorAll('[data-i18n="blog.share"]').forEach(el => el.textContent = t('blog.share'));
				document.querySelectorAll('[data-i18n-title="blog.shareTwitter"]').forEach(el => el.setAttribute('title', t('blog.shareTwitter')));
				document.querySelectorAll('[data-i18n-title="blog.shareLinkedin"]').forEach(el => el.setAttribute('title', t('blog.shareLinkedin')));
				
				// Update project page
				document.querySelectorAll('[data-i18n="projects.backToProjects"]').forEach(el => el.textContent = t('projects.backToProjects'));
				document.querySelectorAll('[data-i18n="projects.viewLive"]').forEach(el => el.textContent = t('projects.viewLive'));
				document.querySelectorAll('[data-i18n="projects.sourceCode"]').forEach(el => el.textContent = t('projects.sourceCode'));
				document.querySelectorAll('[data-i18n="projects.relatedProjects"]').forEach(el => el.textContent = t('projects.relatedProjects'));
			}
			
			// Initialize on page load
			document.addEventListener('astro:page-load', () => {
				const main = document.querySelector('main');
				if (main) {
					main.style.opacity = '0';
					main.style.transform = 'translateY(20px)';
					requestAnimationFrame(() => {
						main.style.transition = 'opacity 0.6s cubic-bezier(0.22, 1, 0.36, 1), transform 0.6s cubic-bezier(0.22, 1, 0.36, 1)';
						main.style.opacity = '1';
						main.style.transform = 'translateY(0)';
					});
				}

				// Mouse tracking for glass cards
				const cards = document.querySelectorAll('.bento-card, .glass-card');
				cards.forEach(card => {
					card.addEventListener('mousemove', (e) => {
						const rect = card.getBoundingClientRect();
						const x = ((e.clientX - rect.left) / rect.width) * 100;
						const y = ((e.clientY - rect.top) / rect.height) * 100;
						(card as HTMLElement).style.setProperty('--mouse-x', `${x}%`);
						(card as HTMLElement).style.setProperty('--mouse-y', `${y}%`);
					});
				});

				// Ecouteur d'événement pour le changement de langue déclenché par le Header
				// Le Header gère le clic, nous mettons simplement à jour le contenu
				window.addEventListener('languageChange', () => {
					applyTranslations();
				});
				
				// Apply translations on load
				applyTranslations();
			});
		</script>
	</body>
</html>